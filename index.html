<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dnepr Fly</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
    body {
        display: flex; justify-content: center; align-items: center;
        height: 100vh; margin: 0;
        background-color: #1a2a6c;
        font-family: 'Courier New', monospace; overflow: hidden;
        image-rendering: pixelated;
    }
    .game-container { position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden; }
    #gameCanvas { background-color: #87CEEB; display: block; border: 5px solid #2a7a8c; border-radius: 8px; }
    .score { position: absolute; top: 10px; left: 10px; font-size: 24px; font-weight: bold; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); z-index: 5; }
    .start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: rgba(0,0,0,0.85); color: white; z-index: 10; }
    .start-screen h1 { font-size: 40px; margin-bottom: 20px; color: #ffd700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
    .start-screen p { font-size: 16px; margin-bottom: 30px; text-align: center; max-width: 80%; line-height: 1.5; }
    .start-button { padding: 12px 30px; font-size: 20px; background-color: #0057b8; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.3); font-family: 'Courier New', monospace; }
    .start-button:hover { background-color: #ffd700; color: #0057b8; transform: scale(1.05); }
</style>
</head>
<body>
<div class="game-container">
    <div class="score">SCORE: 0</div>
    <canvas id="gameCanvas"></canvas>
    <div class="start-screen">
        <h1>DNEPR FLY</h1>
        <p>Tap to fly the plane and avoid the buildings. Good luck!</p>
        <button class="start-button">START FLIGHT</button>
    </div>
</div>
<script>
const planeImage = new Image();
planeImage.src = 'data:image/png;base64,PUT-YOUR-BASE64-HERE';
let imageLoaded = false;
let planeMask = [];

planeImage.onload = () => {
    imageLoaded = true;
    planeMask = createMask(planeImage);
};

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreElement = document.querySelector(".score");
const startScreen = document.querySelector(".start-screen");
const startButton = document.querySelector(".start-button");
const startScreenTitle = startScreen.querySelector('h1');

canvas.width = 360;
canvas.height = 600;
ctx.imageSmoothingEnabled = false;

let gameOver = false, score = 0, gameStarted = false, cityBackground, frames = 0, gameSpeed = 1.5;

function createCityBackground() {
    const bgCanvas = document.createElement('canvas');
    bgCanvas.width = canvas.width;
    bgCanvas.height = canvas.height;
    const bgCtx = bgCanvas.getContext('2d');
    bgCtx.imageSmoothingEnabled = false;
    const gradient = bgCtx.createLinearGradient(0, 0, 0, bgCanvas.height);
    gradient.addColorStop(0, '#4a7db9');
    gradient.addColorStop(0.7, '#87CEEB');
    bgCtx.fillStyle = gradient;
    bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
    bgCtx.fillStyle = '#ffdd00';
    bgCtx.beginPath();
    bgCtx.arc(300, 80, 40, 0, Math.PI * 2);
    bgCtx.fill();
    bgCtx.fillStyle = '#2c3e50';
    for (let i = 0; i < bgCanvas.width; i += 40) {
        const h = 60 + Math.random() * 80;
        bgCtx.fillRect(i, bgCanvas.height - 120 - h, 35, h);
    }
    bgCtx.fillStyle = '#34495e';
    for (let i = 0; i < bgCanvas.width; i += 30) {
        const h = 40 + Math.random() * 60;
        bgCtx.fillRect(i, bgCanvas.height - 80 - h, 25, h);
    }
    bgCtx.fillStyle = '#3498db';
    bgCtx.fillRect(0, bgCanvas.height - 20, bgCanvas.width, 20);
    return bgCanvas;
}

function createMask(image) {
    const offCanvas = document.createElement('canvas');
    offCanvas.width = image.width;
    offCanvas.height = image.height;
    const offCtx = offCanvas.getContext('2d');
    offCtx.drawImage(image, 0, 0);
    const data = offCtx.getImageData(0, 0, image.width, image.height).data;
    const mask = [];
    for (let i = 0; i < data.length; i += 4) {
        mask.push(data[i + 3] > 0);
    }
    return mask;
}

function rectsOverlap(a, b) {
    return !(a.x + a.width <= b.x || a.x >= b.x + b.width || a.y + a.height <= b.y || a.y >= b.y + b.height);
}

function pixelPerfectCollision(spriteA, maskA, spriteB) {
    if (!rectsOverlap(spriteA, spriteB)) return false;
    const startX = Math.max(spriteA.x, spriteB.x);
    const startY = Math.max(spriteA.y, spriteB.y);
    const endX = Math.min(spriteA.x + spriteA.width, spriteB.x + spriteB.width);
    const endY = Math.min(spriteA.y + spriteA.height, spriteB.y + spriteB.height);
    for (let y = startY; y < endY; y++) {
        for (let x = startX; x < endX; x++) {
            const ax = Math.floor((x - spriteA.x) * (planeImage.width / spriteA.width));
            const ay = Math.floor((y - spriteA.y) * (planeImage.height / spriteA.height));
            const bx = x - spriteB.x;
            const by = y - spriteB.y;
            if (maskA[ay * planeImage.width + ax] && spriteB.mask && spriteB.mask[by * spriteB.width + bx]) {
                return true;
            }
        }
    }
    return false;
}

const plane = {
    x: 60, y: 250, width: 45, height: 26,
    gravity: 0.25, lift: -5, velocity: 0, rotation: 0,
    draw() {
        if (!imageLoaded) return;
        ctx.save();
        ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
        ctx.rotate(this.rotation);
        ctx.drawImage(planeImage, -this.width / 2, -this.height / 2, this.width, this.height);
        ctx.restore();
    },
    flap() { this.velocity = this.lift; },
    update() {
        this.velocity += this.gravity;
        this.y += this.velocity;
        this.rotation = Math.min(Math.max(this.velocity / 15, -0.4), 0.7);
        if (this.y + this.height > canvas.height || this.y < 0) setGameOver();
    }
};

const obstacles = {
    list: [], width: 50, gap: 180,
    spawn() {
        if (frames % 120 === 0) {
            const topHeight = Math.floor(Math.random() * (canvas.height - this.gap - 150)) + 75;
            this.list.push({ x: canvas.width
